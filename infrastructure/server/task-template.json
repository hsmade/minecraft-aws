[
  {
    "name": "setup",
    "taskRoleArn": "${sidecars_role_arn}",
    "image": "${setup_image}",
    "entrypoint": ["/scripts/setup.sh"],
    "essential": false,
    "logConfiguration": {
      "logDriver":"awslogs",
      "options": {
        "awslogs-group": "minecraft",
        "awslogs-region": "${region}",
        "awslogs-create-group": "true",
        "awslogs-stream-prefix": "${name}"
      }
    },
    "mountPoints": [
      {
        "containerPath": "/data",
        "sourceVolume": "data"
      }
    ],
    "environment": [
      {
        "name": "BUCKET",
        "value": "${bucket_name}"
      },
      {
        "name": "NAME",
        "value": "${name}"
      }
    ]
  },
  {
    "name": "teardown",
    "taskRoleArn": "${sidecars_role_arn}",
    "image": "${teardown_image}",
    "entrypoint": ["/scripts/teardown.sh"],
    "essential": false,
    "logConfiguration": {
      "logDriver":"awslogs",
      "options": {
        "awslogs-group": "minecraft",
        "awslogs-region": "${region}",
        "awslogs-create-group": "true",
        "awslogs-stream-prefix": "${name}"
      }
    },
    "mountPoints": [
      {
        "readOnly": true,
        "containerPath": "/data",
        "sourceVolume": "data"
      }
    ],
    "environment": [
      {
        "name": "BUCKET",
        "value": "${bucket_name}"
      },
      {
        "name": "NAME",
        "value": "${name}"
      }
    ],
    "dependsOn": [
      {
        "containerName": "main",
        "condition": "COMPLETE"
      }
    ]
  },
  {
    "name": "backup",
    "taskRoleArn": "${sidecars_role_arn}",
    "image": "${backup_image}",
    "essential": true,
    "logConfiguration": {
      "logDriver":"awslogs",
      "options": {
        "awslogs-group": "minecraft",
        "awslogs-region": "${region}",
        "awslogs-create-group": "true",
        "awslogs-stream-prefix": "${name}"
      }
    },
    "mountPoints": [
      {
        "readOnly": true,
        "containerPath": "/data",
        "sourceVolume": "data"
      }
    ],
    "environment": [
      {
        "name" : "RCON_HOST",
        "value": "main"
      },
      {
        "name" : "BACKUP_METHOD",
        "value": "rclone"
      },
      {
        "name" : "BACKUP_NAME",
        "value": "${name}"
      },
      {
        "name" : "INITIAL_DELAY",
        "value": "5m"
      },
      {
        "name" : "BACKUP_INTERVAL",
        "value": "5m"
      },
      {
        "name" : "PAUSE_IF_NO_PLAYERS",
        "value": "true"
      },
      {
        "name" : "PLAYERS_ONLINE_CHECK_INTERVAL",
        "value": "5m"
      },
      {
        "name" : "PRUNE_BACKUPS_DAYS",
        "value": "3"
      },
      {
        "name" : "EXCLUDES",
        "value": "cache,logs"
      },
      {
        "name" : "RCLONE_REMOTE",
        "value": "s3"
      }
    ]
  },
  {
    "name": "main",
    "image": "${main_image}",
    "essential": false,
    "logConfiguration": {
      "logDriver":"awslogs",
      "options": {
        "awslogs-group": "minecraft",
        "awslogs-region": "${region}",
        "awslogs-create-group": "true",
        "awslogs-stream-prefix": "${name}"
      }
    },
    "mountPoints": [
      {
        "containerPath": "/data",
        "sourceVolume": "data"
      }
    ],
    "environment": [
      {
        "name": "EULA",
        "value": "TRUE"
      },
      {
        "name": "TYPE",
        "value": "${minecraft_type}"
      },
      {
        "name": "VERSION",
        "value": "${minecraft_version}"
      },
     {
        "name": "FORGEVERSION",
        "value": "${forge_version}"
      }
    ],
    "dependsOn": [
      {
        "containerName": "setup",
        "condition": "SUCCESS"
      }
    ]
  }
]